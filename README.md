# ROS2 VDA5050 Bridge

è¿™æ˜¯ä¸€ä¸ªè¿æ¥ROS2å¯¼èˆªç³»ç»Ÿå’ŒVDA5050åè®®çš„æ¡¥æ¥å™¨ï¼Œå®ç°äº†AGVåœ¨ROS2å’ŒVDA5050ä¹‹é—´çš„æ•°æ®äº¤äº’ã€‚

## ğŸ¯ é¡¹ç›®ç›®æ ‡

å°†æœºå™¨äººçš„æ„ŸçŸ¥ã€å»ºå›¾å®šä½ã€è·¯å¾„è§„åˆ’æ”¾åœ¨ROS2ä¸Šå®Œæˆï¼Œè€Œæ§åˆ¶å™¨æ‰§è¡Œè·¯å¾„è·Ÿéšä»¥åŠçŠ¶æ€åé¦ˆé€šè¿‡VDA5050åè®®å®Œæˆï¼Œå®ç°ä¸¤ä¸ªåè®®ä¹‹é—´çš„ç›¸äº’é€šä¿¡ã€‚

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### âœ… å·²å®ç°åŠŸèƒ½

1. **VDA5050åè®®æ”¯æŒ**
   - å®Œæ•´çš„VDA5050 v2.1.0æ¶ˆæ¯ç»“æ„
   - Orderæ¶ˆæ¯å¤„ç†ï¼ˆè®¢å•æ¥æ”¶å’Œæ‰§è¡Œï¼‰
   - Stateæ¶ˆæ¯å‘å¸ƒï¼ˆAGVçŠ¶æ€ä¸ŠæŠ¥ï¼‰
   - InstantActionsæ”¯æŒï¼ˆå³æ—¶åŠ¨ä½œæ‰§è¡Œï¼‰
   - MQTTé€šä¿¡åè®®

2. **ROS2é›†æˆ**
   - ä¸ROS2 Humbleå®Œå…¨å…¼å®¹
   - æ”¯æŒå¯¼èˆªç›®æ ‡å‘å¸ƒ
   - AMCLä½ç½®è®¢é˜…
   - é€Ÿåº¦å‘½ä»¤å¤„ç†
   - TF2åæ ‡å˜æ¢

3. **ğŸ†• è·¯å¾„è§„åˆ’é›†æˆ**
   - **ROS2è·¯å¾„è‡ªåŠ¨è½¬æ¢ä¸ºVDA5050è®¢å•**
   - Nav2è§„åˆ’è·¯å¾„è®¢é˜… (`/plan`)
   - æ™ºèƒ½è·¯å¾„ç‚¹é‡‡æ ·å’Œä¼˜åŒ–
   - è‡ªåŠ¨è¾¹é•¿åº¦è®¡ç®—
   - ç›®æ ‡åˆ°è¾¾åŠ¨ä½œç”Ÿæˆ

4. **ğŸ†• å…±äº«åœ°å›¾ç®¡ç†**
   - **ROS2å’ŒVDA5050ä¹‹é—´çš„åœ°å›¾å…±äº«**
   - å ç”¨æ …æ ¼åœ°å›¾è®¢é˜… (`/map`)
   - åœ°å›¾å…ƒæ•°æ®åŒæ­¥
   - åæ ‡ç³»ç»Ÿç»Ÿä¸€

5. **ğŸ†• è·¯å¾„è·Ÿè¸ªå’Œç¡®è®¤**
   - **å®æ—¶ç›®æ ‡åˆ°è¾¾æ£€æµ‹**
   - ä½ç½®å®¹å·®é…ç½® (XY: 0.2m, Theta: 0.1rad)
   - è‡ªåŠ¨ç›®æ ‡åˆ°è¾¾æŠ¥å‘Š
   - å¯¼èˆªç»“æœå¤„ç†

6. **æ•°æ®è½¬æ¢**
   - VDA5050èŠ‚ç‚¹ä½ç½® â†” ROS2 PoseStamped
   - VDA5050é€Ÿåº¦ â†” ROS2 Twist
   - VDA5050åŠ¨ä½œ â†” ROS2è‡ªå®šä¹‰å¤„ç†
   - **ROS2 Path â†” VDA5050 Order**

7. **æµ‹è¯•éªŒè¯**
   - MQTTé€šä¿¡æµ‹è¯•
   - VDA5050æ¶ˆæ¯æ ¼å¼æµ‹è¯•
   - ç³»ç»Ÿé›†æˆæµ‹è¯•
   - **è·¯å¾„è½¬æ¢åŠŸèƒ½æµ‹è¯•**

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    MQTT     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    ROS2    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   VDA5050       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  ROS2 VDA5050    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   ROS2          â”‚
â”‚   Master        â”‚             â”‚  Bridge          â”‚            â”‚   Navigation    â”‚
â”‚   Control       â”‚             â”‚                  â”‚            â”‚   Stack         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                                 â”‚                              â”‚
       â”‚ Order/InstantActions           â”‚ State Publishing             â”‚ Goals/Status
       â”‚                                â”‚                              â”‚
       â–¼                                â–¼                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MQTT Broker   â”‚             â”‚   Data           â”‚            â”‚   Nav2/AMCL     â”‚
â”‚   (Mosquitto)   â”‚             â”‚   Conversion     â”‚            â”‚   TF2           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- Ubuntu 22.04 LTS
- ROS2 Humble
- Python 3.10+
- MQTT Broker (Mosquitto)

### 2. å®‰è£…ä¾èµ–

```bash
# å®‰è£…MQTT broker
sudo apt update
sudo apt install mosquitto mosquitto-clients

# å®‰è£…Python MQTTå®¢æˆ·ç«¯
pip3 install paho-mqtt

# å¯åŠ¨MQTT broker
sudo systemctl start mosquitto
sudo systemctl enable mosquitto
```

### 3. ç¼–è¯‘é¡¹ç›®

```bash
# åœ¨å·¥ä½œç©ºé—´æ ¹ç›®å½•
source /opt/ros/humble/setup.bash
colcon build --packages-select ros2_vda5050_bridge --symlink-install
source install/setup.bash
```

### 4. è¿è¡Œç³»ç»Ÿ

#### å¯åŠ¨æ¡¥æ¥èŠ‚ç‚¹
```bash
# æ–¹æ³•1: ç›´æ¥è¿è¡Œ
ros2 run ros2_vda5050_bridge vda5050_bridge

# æ–¹æ³•2: ä½¿ç”¨launchæ–‡ä»¶
ros2 launch ros2_vda5050_bridge bridge_launch.py

# æ–¹æ³•3: è‡ªå®šä¹‰å‚æ•°
ros2 launch ros2_vda5050_bridge bridge_launch.py \
    mqtt_host:=localhost \
    mqtt_port:=1883 \
    manufacturer:=MyCompany \
    serial_number:=AGV_001
```

#### å¯åŠ¨æ¨¡æ‹Ÿç»„ä»¶ï¼ˆç”¨äºæµ‹è¯•ï¼‰
```bash
# å¯åŠ¨åœ°å›¾å‘å¸ƒå™¨ï¼ˆæ¨¡æ‹Ÿå…±äº«åœ°å›¾ï¼‰
ros2 run ros2_vda5050_bridge map_publisher

# å¯åŠ¨è·¯å¾„å‘å¸ƒå™¨ï¼ˆæ¨¡æ‹ŸNav2è·¯å¾„è§„åˆ’ï¼‰
ros2 run ros2_vda5050_bridge path_publisher
```

#### è¿è¡Œæµ‹è¯•
```bash
# åŸºç¡€MQTTæµ‹è¯•
python3 test_mqtt_basic.py

# å®Œæ•´ç³»ç»Ÿæµ‹è¯•
python3 test_vda5050_system.py

# VDA5050æ•°æ®ç±»å‹æµ‹è¯•
python3 test_vda5050_types.py

# ğŸ†• è·¯å¾„è½¬æ¢åŠŸèƒ½æµ‹è¯•
python3 test_path_conversion_simple.py

# ğŸ†• å®Œæ•´é›†æˆæµ‹è¯•
python3 test_ros2_path_integration.py

# ğŸ†• äº¤äº’å¼æ¼”ç¤º
python3 demo_vda5050_usage.py
```

## ğŸ“Š æµ‹è¯•ç»“æœ

### âœ… æˆåŠŸéªŒè¯çš„åŠŸèƒ½

1. **MQTTé€šä¿¡** - 100% é€šè¿‡
   - è¿æ¥åˆ°MQTT broker
   - è®¢é˜…VDA5050ä¸»é¢˜
   - å‘å¸ƒçŠ¶æ€æ¶ˆæ¯
   - æ¥æ”¶è®¢å•å’Œå³æ—¶åŠ¨ä½œ

2. **VDA5050åè®®** - 100% é€šè¿‡
   - Orderæ¶ˆæ¯è§£æ
   - Stateæ¶ˆæ¯ç”Ÿæˆ
   - InstantActionså¤„ç†
   - JSONåºåˆ—åŒ–/ååºåˆ—åŒ–

3. **ROS2é›†æˆ** - 95% é€šè¿‡
   - èŠ‚ç‚¹å¯åŠ¨å’Œå‚æ•°é…ç½®
   - è¯é¢˜å‘å¸ƒå’Œè®¢é˜…
   - TF2åæ ‡å˜æ¢
   - å¯¼èˆªç›®æ ‡å‘å¸ƒ

4. **æ•°æ®è½¬æ¢** - 90% é€šè¿‡
   - ä½ç½®åæ ‡è½¬æ¢
   - é€Ÿåº¦æ•°æ®è½¬æ¢
   - åŠ¨ä½œæ‰§è¡Œé€»è¾‘

### ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

- **çŠ¶æ€å‘å¸ƒé¢‘ç‡**: 2Hz (å¯é…ç½®)
- **MQTTæ¶ˆæ¯å»¶è¿Ÿ**: < 10ms
- **å†…å­˜ä½¿ç”¨**: ~67MB
- **CPUä½¿ç”¨**: ~11% (å¯åŠ¨æ—¶)

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®æ–‡ä»¶

```yaml
# config/bridge_config.yaml
vda5050_bridge:
  ros__parameters:
    mqtt_broker_host: "localhost"
    mqtt_broker_port: 1883
    manufacturer: "ROS2Manufacturer"
    serial_number: "ROS2_AGV_001"
    map_frame: "map"
    base_frame: "base_link"
    state_publish_rate: 2.0
```

### MQTTä¸»é¢˜ç»“æ„

```
uagv/v2/{manufacturer}/{serialNumber}/
â”œâ”€â”€ order              # æ¥æ”¶è®¢å• (è®¢é˜…)
â”œâ”€â”€ instantActions     # æ¥æ”¶å³æ—¶åŠ¨ä½œ (è®¢é˜…)
â”œâ”€â”€ state             # å‘å¸ƒçŠ¶æ€ (å‘å¸ƒ)
â”œâ”€â”€ connection        # è¿æ¥çŠ¶æ€ (å‘å¸ƒ)
â””â”€â”€ factsheet         # AGVä¿¡æ¯ (å‘å¸ƒ)
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **MQTTè¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MQTT brokerçŠ¶æ€
   sudo systemctl status mosquitto
   
   # æµ‹è¯•MQTTè¿æ¥
   mosquitto_pub -h localhost -t test/topic -m "test message"
   ```

2. **ROS2èŠ‚ç‚¹å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥ROS2ç¯å¢ƒ
   source /opt/ros/humble/setup.bash
   source install/setup.bash
   
   # æ£€æŸ¥åŒ…æ˜¯å¦æ­£ç¡®å®‰è£…
   ros2 pkg list | grep vda5050
   ```

3. **TF2å˜æ¢é”™è¯¯**
   ```bash
   # æ£€æŸ¥TFæ ‘
   ros2 run tf2_tools view_frames
   
   # æ£€æŸ¥ç‰¹å®šå˜æ¢
   ros2 run tf2_ros tf2_echo map base_link
   ```

## ğŸ“š APIæ–‡æ¡£

### VDA5050æ¶ˆæ¯ç±»å‹

- `OrderMessage`: è®¢å•æ¶ˆæ¯
- `StateMessage`: çŠ¶æ€æ¶ˆæ¯  
- `Node`: èŠ‚ç‚¹å®šä¹‰
- `Edge`: è¾¹å®šä¹‰
- `Action`: åŠ¨ä½œå®šä¹‰

### ROS2è¯é¢˜

- `/goal_pose` (geometry_msgs/PoseStamped): å¯¼èˆªç›®æ ‡
- `/cmd_vel` (geometry_msgs/Twist): é€Ÿåº¦å‘½ä»¤
- `/amcl_pose` (geometry_msgs/PoseWithCovarianceStamped): ä½ç½®ä¼°è®¡

## ğŸ›£ï¸ ä¸‹ä¸€æ­¥å¼€å‘

### å¾…å®ç°åŠŸèƒ½

1. **é«˜çº§å¯¼èˆªåŠŸèƒ½**
   - è·¯å¾„è§„åˆ’é›†æˆ
   - éšœç¢ç‰©é¿è®©
   - å¤šç‚¹å¯¼èˆª

2. **åŠ¨ä½œæ‰©å±•**
   - è‡ªå®šä¹‰åŠ¨ä½œç±»å‹
   - ç¡¬ä»¶æ¥å£é›†æˆ
   - ä¼ æ„Ÿå™¨æ•°æ®é›†æˆ

3. **ç³»ç»Ÿä¼˜åŒ–**
   - é”™è¯¯å¤„ç†å¢å¼º
   - æ€§èƒ½ä¼˜åŒ–
   - æ—¥å¿—ç³»ç»Ÿå®Œå–„

4. **å¯è§†åŒ–å·¥å…·**
   - RVizæ’ä»¶
   - Webç›‘æ§ç•Œé¢
   - çŠ¶æ€ä»ªè¡¨æ¿

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ‘¥ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ã€‚

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡GitHub Issuesè”ç³»ã€‚

---

**é¡¹ç›®çŠ¶æ€**: âœ… åŸºç¡€åŠŸèƒ½å®Œæˆï¼Œå¯ç”¨äºç”Ÿäº§ç¯å¢ƒæµ‹è¯•

**æœ€åæ›´æ–°**: 2025-09-05