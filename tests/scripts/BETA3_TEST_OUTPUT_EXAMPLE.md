# Beta-3 测试程序输出示例

本文档展示 `test_beta3_trajectory_workflow.py` 的详细输出格式，方便调试时对比发送方和接收方的数据。

## 程序启动

```
🧪 增强型Beta-3轨迹工作流程测试
================================================================================
测试说明：
  • 启动后等待10秒获取/Odom话题
  • 如果10秒内没有收到，使用默认位置(0, 0, 0)
  • flag只使用0或1
  • 生成两条完整轨迹并发布
================================================================================
🚀 连接到MQTT代理: localhost:1883
✅ MQTT连接成功
📡 订阅轨迹主题: EP/robot-001/embrain/cerebellum/trajectory

⏳ 等待 /Odom 话题数据（最多等待 10 秒）...
```

## 情况1: 收到 /Odom 话题

```
✅ 已接收到 /Odom 话题数据
   当前位置: (0.000, 0.000), 朝向: 0.0°
✅ 成功获取 /Odom 话题数据
```

## 情况2: 未收到 /Odom 话题（超时）

```
⚠️  10秒内未收到 /Odom 话题，使用默认位置数据
   默认位置: (0.000, 0.000), 朝向: 0.0°
```

## 第一条轨迹发布

```
⏱️  准备发布第一条轨迹...

================================================================================
📤 发布第一条轨迹
================================================================================
流程：
  1. 直行3米
  2. 原地右转90度
  3. 停顿2秒
  4. 原地左转90度回正
  5. 直行0.5米
参数：orientation=0.0, flag=0 (前向运动，非分支)
================================================================================
✅ 第一条轨迹生成完成，共 27 个路径点
   起点: (0.000, 0.000)
   终点: (3.500, 0.000)

================================================================================
📋 第一条轨迹发布详情（用于对比接收方）
================================================================================
Header:
  frame_id: map|none|none|0.0|0|0|0|0|0|0
  timestamp: 1727876400.123456789

路径点数量: 27

前3个路径点示例:
  点1: x=0.000, y=0.000, theta=0.000 (0.0°)
  点2: x=0.300, y=0.000, theta=0.000 (0.0°)
  点3: x=0.600, y=0.000, theta=0.000 (0.0°)

最后1个路径点:
  点27: x=3.500, y=0.000, theta=0.000 (0.0°)

解析后的Beta-3参数:
  orientation: 0.0 (前向运动)
  flag: 0 (非分支)
  action: null (无动作)
================================================================================
📡 第一条轨迹已发布到 /plans 话题
```

## MQTT接收到的轨迹消息（第一条）

```
================================================================================
🚀 收到Beta-3轨迹消息！
================================================================================
📋 轨迹ID: traj-robot-001-1727876400-001
⏰ 时间戳: 2025-10-02T08:00:00.123Z
🏃 最大速度: 1.5 m/s
📍 轨迹点数量: 27

🔍 Beta-3字段验证:
   🔄 运动方向 (orientation): 0.0
      ✅ 前向运动
   🌿 分支标志 (flag): 0
      ✅ 非分支状态
   🎯 动作 (action): None
      ✅ 无动作（纯行驶）

📍 轨迹点信息:
   起点: (0.000, 0.000), θ=0.000
   终点: (3.500, 0.000), θ=0.000

📊 已接收轨迹消息数量: 1
================================================================================
```

## 第二条轨迹发布

```
⏱️  等待5秒后发布第二条轨迹...

================================================================================
📤 发布第二条轨迹
================================================================================
流程：
  1. 模拟收到container_pose
  2. 原地左转90度
  3. 倒车0.5米
参数：orientation=3.14, flag=1 (倒车运动，进入分支)
================================================================================
✅ 第二条轨迹生成完成，共 11 个路径点
   起点: (3.500, 0.000)
   终点: (3.500, -0.500)
   Container位姿: (4.50, 1.00, 0.10)

================================================================================
📋 第二条轨迹发布详情（用于对比接收方）
================================================================================
Header:
  frame_id: map|pub_unload_params|AGV-T300|3.14|1|4.5|1.0|0.1|0.0|1.2
  timestamp: 1727876405.987654321

路径点数量: 11

前3个路径点示例:
  点1: x=3.500, y=0.000, theta=0.000 (0.0°)
  点2: x=3.500, y=0.000, theta=0.314 (18.0°)
  点3: x=3.500, y=0.000, theta=0.628 (36.0°)

最后1个路径点:
  点11: x=3.500, y=-0.500, theta=1.571 (90.0°)

解析后的Beta-3参数:
  orientation: 3.14 (倒车运动)
  flag: 1 (进入分支)
  action: pub_unload_params
  containerType: AGV-T300
  containerPose:
    x: 4.50, y: 1.00, z: 0.10
    theta: 0.00, width: 1.20
================================================================================
📡 第二条轨迹已发布到 /plans 话题
```

## MQTT接收到的轨迹消息（第二条）

```
================================================================================
🚀 收到Beta-3轨迹消息！
================================================================================
📋 轨迹ID: traj-robot-001-1727876405-002
⏰ 时间戳: 2025-10-02T08:00:05.987Z
🏃 最大速度: 1.5 m/s
📍 轨迹点数量: 11

🔍 Beta-3字段验证:
   🔄 运动方向 (orientation): 3.14
      ✅ 倒车运动
   🌿 分支标志 (flag): 1
      ✅ 进入分支状态
   🎯 动作 (action): <action object>
      ✅ 动作类型: pub_unload_params
         容器类型: AGV-T300

📍 轨迹点信息:
   起点: (3.500, 0.000), θ=0.000
   终点: (3.500, -0.500), θ=1.571

📊 已接收轨迹消息数量: 2
================================================================================
```

## 程序结束

```
✅ 两条轨迹均已发布完成
💡 保持运行以监听MQTT轨迹消息...
   按 Ctrl+C 停止测试

^C
⏹️ 收到中断信号，正在停止测试...
🛑 测试已停止
```

## 调试对比要点

### 1. 检查 frame_id 编码

**发送方（测试程序）:**
```
frame_id: map|pub_unload_params|AGV-T300|3.14|1|4.5|1.0|0.1|0.0|1.2
```

**接收方应解析为:**
- 坐标系: `map`
- 动作类型: `pub_unload_params`
- 容器类型: `AGV-T300`
- orientation: `3.14`
- flag: `1`
- containerPose: `x=4.5, y=1.0, z=0.1, theta=0.0, width=1.2`

### 2. 检查轨迹点数量

**发送方:** 27个路径点（第一条），11个路径点（第二条）
**接收方:** 应该收到相同数量的轨迹点

### 3. 检查Beta-3参数

**第一条轨迹:**
- orientation: `0.0` ✅ (前向)
- flag: `0` ✅ (非分支)
- action: `null` ✅ (无动作)

**第二条轨迹:**
- orientation: `3.14` ✅ (倒车)
- flag: `1` ✅ (进入分支)
- action: `pub_unload_params` ✅ (卸货参数)

### 4. 检查容器位姿

**发送方:**
```
containerPose:
  x: 4.50, y: 1.00, z: 0.10
  theta: 0.00, width: 1.20
```

**接收方应匹配:**
```json
"containerPose": {
  "x": 4.5,
  "y": 1.0,
  "z": 0.1,
  "theta": 0.0,
  "width": 1.2
}
```

## 常见问题排查

### Flag值不正确
- ❌ 错误: `flag: 0.5`（之前的bug）
- ✅ 正确: `flag: 0` 或 `flag: 1`

### Orientation值不正确
- ❌ 错误: `orientation: 1.57`, `orientation: 2.0`
- ✅ 正确: `orientation: 0.0`, `orientation: 3.14`, `orientation: -3.14`

### ActionType不符合协议
- ❌ 错误: `actionType: "custom_action"`
- ✅ 正确: `ground_pick`, `ground_place`, `load`, `unload`, `pub_load_params`, `pub_unload_params`, `start_stacking`
