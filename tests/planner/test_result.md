# 录测试结果

python3 test_complex_planner_workflow.py 
🧪 ComplexTrajectoryPlanner 完整工作流程测试
================================================================================
测试说明：
  1. 等待 /Odom 获取当前位置（起点）
  2. 等待 /nav_goal 获取目标点
  3. 自动计算转弯角度和前进距离
  4. 规划并发布前向轨迹（两次转弯 + 前进）
  5. 等待完成后规划并发布后向轨迹（倒车1米）
================================================================================
倒车距离: 1.0m
================================================================================

/home/yhg/Documents/ep-embodied/mqtt_bridge/tests/planner/test_complex_planner_workflow.py:74: DeprecationWarning: Callback API version 1 is deprecated, update to latest version
  self.mqtt_client = mqtt.Client()
✅ ComplexPlannerTester 节点已启动
   规划器: ComplexTrajectoryPlanner
   Service: /trajectory_status

🚀 连接到MQTT代理: localhost:1883
✅ MQTT连接成功
📡 订阅轨迹状态主题: EP/robot-001/cerebellum/embrain/trajectory_status

⏳ 等待 /Odom 话题数据（最多等待 10 秒）...
✅ 已接收到 /Odom 话题数据
   当前位置: (3.000, 0.000), 朝向: -1.571 (-90.0°)

✅ 成功获取 /Odom 话题数据

⏳ 等待目标点 /nav_goal 话题数据...
   无超时限制（按Ctrl+C可中断）

✅ 已接收到目标点 /nav_goal
   目标位置: (4.000, 1.000), 朝向: 1.571 (90.0°)

✅ 成功获取目标点数据


⏱️  准备发布前向轨迹...

================================================================================
📤 规划并发布前向轨迹（Traj1 + Traj2 组合）
================================================================================
📡 获取最新Odom数据...

📍 起点: (3.000, 0.000), yaw=-1.571 (-90.0°)
📍 终点: (4.000, 1.000), yaw=1.571 (90.0°)

📍 中间点（第1段终点，第2段起点）:
   位置: (4.000, 2.000)
   朝向: 1.571 (90.0°)

📐 自动计算参数:
   第一次转弯: 1.571 rad (90.0°)
   前进距离: 1.000 m
   第二次转弯: 1.571 rad (90.0°)

📍 第1段轨迹终点验证:
   规划终点: (4.000, 0.000), yaw=1.571 (90.0°)
   中间点: (4.000, 2.000), yaw=1.571 (90.0°)
   位置误差: 2.000 m
   朝向误差: 0.000 rad (0.0°)


📋 复杂前向轨迹规划:
   起点: (3.000, 0.000), yaw=-1.571 (-90.0°)
   第一次左转: 90.0°
   前进距离: 1.000m
   第二次左转: 90.0°
   阶段1: 原地左转 90.0°
   阶段2: 前进 1.000m (点间距0.15m, 7个点)
   阶段3: 原地左转 90.0°
   ✅ 前向轨迹规划完成: 共 10 个路径点
   终点: (4.000, 0.000), yaw=1.571 (90.0°)


✅ 前向轨迹生成完成，共 10 个路径点

所有路径点:
  点1: x=3.000, y=0.000, yaw=-1.571 (-90.0°)
  点2: x=3.000, y=0.000, yaw=0.000 (0.0°)
  点3: x=3.150, y=0.000, yaw=0.000 (0.0°)
  点4: x=3.300, y=0.000, yaw=0.000 (0.0°)
  点5: x=3.450, y=0.000, yaw=0.000 (0.0°)
  点6: x=3.600, y=0.000, yaw=0.000 (0.0°)
  点7: x=3.750, y=0.000, yaw=0.000 (0.0°)
  点8: x=3.900, y=0.000, yaw=0.000 (0.0°)
  点9: x=4.000, y=0.000, yaw=0.000 (0.0°)
  点10: x=4.000, y=0.000, yaw=1.571 (90.0°)

Beta-3参数: orientation=0.0, flag=0 (前向运动)
================================================================================
📤 轨迹已发布到 /plans
📋 轨迹ID: complex_forward_1759631725538

⏳ 等待MQTT轨迹完成信号（按Ctrl+C可中断）...


================================================================================
📊 收到MQTT轨迹状态消息
================================================================================
📋 轨迹ID: complex_forward_1759631725538
📍 状态: running
⏰ 时间戳: 1759631725541

🏃 轨迹执行中...
================================================================================


================================================================================
📊 收到MQTT轨迹状态消息
================================================================================
📋 轨迹ID: complex_forward_1759631725538
📍 状态: completed
⏰ 时间戳: 1759631726543

✅ 轨迹已完成！
================================================================================

✅ 前向轨迹已完成，等待3秒后发布后向轨迹...


================================================================================
📤 规划并发布后向轨迹（Traj3 倒车）
================================================================================
📡 获取最新Odom数据...

📋 后向轨迹规划 (倒车):
   起点: (3.000, 0.000), yaw=-1.571 (-90.0°)
   倒车距离: 1.000m
   生成路径点: 7个 (点间距0.15m)
   ✅ 后向轨迹规划完成: 共 7 个路径点
   终点: (3.000, 1.000), yaw=-1.571 (-90.0°)


✅ 后向轨迹生成完成，共 7 个路径点

所有路径点:
  点1: x=3.000, y=0.000, yaw=-1.571 (-90.0°)
  点2: x=3.000, y=0.150, yaw=-1.571 (-90.0°)
  点3: x=3.000, y=0.300, yaw=-1.571 (-90.0°)
  点4: x=3.000, y=0.450, yaw=-1.571 (-90.0°)
  点5: x=3.000, y=0.600, yaw=-1.571 (-90.0°)
  点6: x=3.000, y=0.750, yaw=-1.571 (-90.0°)
  点7: x=3.000, y=0.900, yaw=-1.571 (-90.0°)

Beta-3参数: orientation=3.14, flag=1 (倒车运动)
容器信息: type=AGV-T300, pos=(4.000, 1.000)
================================================================================
📤 轨迹已发布到 /plans
📋 轨迹ID: complex_backward_1759631729885

⏳ 等待MQTT轨迹完成信号（按Ctrl+C可中断）...


================================================================================
📊 收到MQTT轨迹状态消息
================================================================================
📋 轨迹ID: complex_backward_1759631729885
📍 状态: running
⏰ 时间戳: 1759631729886

🏃 轨迹执行中...
================================================================================


================================================================================
📊 收到MQTT轨迹状态消息
================================================================================
📋 轨迹ID: complex_backward_1759631729885
📍 状态: completed
⏰ 时间戳: 1759631730887

✅ 轨迹已完成！
================================================================================


✅ 所有轨迹发布完成
💡 保持运行以监听MQTT轨迹消息...
   按 Ctrl+C 停止测试

## service 查询结果
python3 query_trajectory_status.py 
⏳ 等待 /trajectory_status service...
✅ Service 已就绪

📞 调用 /trajectory_status service...

================================================================================
📊 轨迹状态查询结果
================================================================================
✅ 查询成功

状态信息:
  轨迹ID: complex_backward_1759631729885
  状态: completed
  时间戳: 1759631730887
  消息: 轨迹执行完成

✅ 轨迹已完成
================================================================================